<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scouting IJsselake  - Agenda Widget</title>
    <link rel="icon" type="image/png" id="favicon" href="">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&family=Poppins:wght@300;400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.0/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="/static/embed.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <v-app>
            <v-container fluid class="pa-0">
                <v-card flat>
                    <v-tabs
                        v-model="activeTab"
                        color="#0C40AA"
                        bg-color="white"
                    >
                        <v-tab v-for="cal in calendars" :key="cal.name" :value="cal.name">
                            <img
                                v-if="getLogoPath(cal.name)"
                                :src="getLogoPath(cal.name)"
                                class="speltak-logo me-2"
                            />
                            <span v-text="cal.display_name"></span>
                        </v-tab>
                    </v-tabs>

                    <v-window v-model="activeTab">
                        <v-window-item v-for="cal in calendars" :key="cal.name" :value="cal.name">
                            <v-card flat class="pa-4">
                                <!-- Info banner -->
                                <v-alert
                                    color="#BCCAE7"
                                    class="mb-4"
                                    border="start"
                                    border-color="#0C40AA"
                                >
                                    <div class="d-flex align-center justify-space-between flex-wrap">
                                        <div>
                                            <div class="text-h6 heading" style="color: #0C40AA;">
                                                <span v-text="cal.display_name"></span> Agenda
                                            </div>
                                            <div class="text-caption mt-1">
                                                <strong>Bronnen:</strong> <span v-text="cal.sources.length"></span> kalender(s) Â·
                                                <strong>Privacy:</strong>
                                                <span v-if="cal.visibility === 'title_only'">Alleen titel</span>
                                                <span v-else-if="cal.visibility === 'busy_only'">Alleen bezet</span>
                                                <span v-else>Alle details</span>
                                            </div>
                                        </div>
                                        <v-btn
                                            color="#0C40AA"
                                            variant="elevated"
                                            @click="showSubscribeDialog(cal)"
                                            class="mt-2 mt-sm-0"
                                        >
                                            <v-icon start>mdi-calendar-plus</v-icon>
                                            Abonneren
                                        </v-btn>
                                    </div>
                                </v-alert>

                                <!-- Calendar -->
                                <div v-if="!cal.protected">
                                    <!-- Month/List view toggle -->
                                    <v-btn-toggle
                                        v-model="viewMode"
                                        color="#0C40AA"
                                        mandatory
                                        class="mb-4"
                                    >
                                        <v-btn value="month">
                                            <v-icon start>mdi-calendar-month</v-icon>
                                            Maand
                                        </v-btn>
                                        <v-btn value="list">
                                            <v-icon start>mdi-format-list-bulleted</v-icon>
                                            Lijst
                                        </v-btn>
                                    </v-btn-toggle>

                                    <!-- Month View -->
                                    <div v-if="viewMode === 'month'" class="calendar-month">
                                        <div class="d-flex align-center justify-space-between mb-4">
                                            <v-btn icon @click="previousMonth" size="small">
                                                <v-icon>mdi-chevron-left</v-icon>
                                            </v-btn>
                                            <h3 class="heading" style="color: #0C40AA;" v-text="currentMonthLabel"></h3>
                                            <v-btn icon @click="nextMonth" size="small">
                                                <v-icon>mdi-chevron-right</v-icon>
                                            </v-btn>
                                        </div>
                                        <div class="calendar-grid">
                                            <div v-for="day in ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo']" :key="day" class="calendar-header">
                                                <span v-text="day"></span>
                                            </div>
                                            <div v-for="day in calendarDays" :key="day.date"
                                                 :class="['calendar-day', { 'other-month': !day.currentMonth, 'has-events': day.events.length > 0 }]"
                                                 @click="showDayEvents(day)">
                                                <div class="day-number" v-text="day.day"></div>
                                                <div v-if="day.events.length > 0" class="event-indicator">
                                                    <span v-text="day.events.length"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- List View -->
                                    <v-list v-else lines="two">
                                        <v-list-item
                                            v-for="event in sortedEvents(cal.name)"
                                            :key="event.title + event.start"
                                            @click="showEvent({ event })"
                                            class="mb-2"
                                            rounded
                                            border
                                        >
                                            <template v-slot:prepend>
                                                <v-icon color="#0C40AA">mdi-calendar</v-icon>
                                            </template>
                                            <v-list-item-title class="heading" v-text="event.title"></v-list-item-title>
                                            <v-list-item-subtitle v-text="formatDate(event.start)"></v-list-item-subtitle>
                                        </v-list-item>
                                        <v-list-item v-if="sortedEvents(cal.name).length === 0">
                                            <v-list-item-title class="text-center text-grey">
                                                Geen events gevonden
                                            </v-list-item-title>
                                        </v-list-item>
                                    </v-list>
                                </div>

                                <v-alert
                                    v-else
                                    type="warning"
                                    variant="tonal"
                                    class="mt-4"
                                >
                                    ðŸ”’ Deze kalender is beveiligd en alleen beschikbaar voor kaderleden. Vraag de webmaster om toegang.
                                </v-alert>
                            </v-card>
                        </v-window-item>
                    </v-window>
                </v-card>

                <!-- Subscribe Dialog -->
                <v-dialog v-model="subscribeDialog" max-width="700" scrollable>
                    <v-card>
                        <v-card-title class="d-flex align-center pa-6 bg-azuurlichtst">
                            <v-icon size="large" color="#0C40AA" class="mr-3">mdi-calendar-plus</v-icon>
                            <span class="heading text-h5" style="color: #0C40AA;">Kalender toevoegen</span>
                        </v-card-title>

                        <v-divider></v-divider>

                        <v-card-text class="pa-6">
                            <v-alert
                                v-if="selectedCalendar && selectedCalendar.protected"
                                color="warning"
                                variant="tonal"
                                prominent
                                class="mb-6"
                                icon="mdi-lock"
                            >
                                <div class="text-subtitle-1 font-weight-bold">Beveiligde kalender</div>
                                <div class="text-body-2">Vervang "WACHTWOORD_HIER" in de URL met het juiste wachtwoord</div>
                            </v-alert>

                            <!-- URL Box -->
                            <v-card
                                variant="outlined"
                                class="pa-4 mb-6 bg-grey-lighten-5"
                                @click="copyUrl"
                                style="cursor: pointer; border: 2px solid #0C40AA; border-radius: 12px;"
                                hover
                            >
                                <div class="d-flex align-center justify-space-between mb-2">
                                    <div class="text-caption font-weight-bold text-grey-darken-1">KALENDER URL</div>
                                    <v-chip size="small" color="#0C40AA" variant="flat">
                                        <v-icon start size="small">mdi-content-copy</v-icon>
                                        Klik om te kopiÃ«ren
                                    </v-chip>
                                </div>
                                <div class="text-body-2 font-mono text-grey-darken-3" style="word-break: break-all; line-height: 1.6;" v-text="subscribeUrl">
                                </div>
                            </v-card>

                            <!-- Instructions -->
                            <div class="text-h6 heading mb-4" style="color: #0C40AA;">
                                ðŸ“± Instructies per platform
                            </div>

                            <v-expansion-panels variant="accordion" class="mb-4">
                                <v-expansion-panel>
                                    <v-expansion-panel-title class="heading">
                                        <v-icon color="#0C40AA" class="mr-3">mdi-google</v-icon>
                                        Google Calendar
                                    </v-expansion-panel-title>
                                    <v-expansion-panel-text>
                                        <ol class="text-body-2 pl-4">
                                            <li class="mb-2">Ga naar <a href="https://calendar.google.com" target="_blank" style="color: #0C40AA; text-decoration: none; font-weight: 600;">calendar.google.com</a></li>
                                            <li class="mb-2">Klik op het <strong>+</strong> icoon naast <em>"Andere agenda's"</em></li>
                                            <li class="mb-2">Selecteer <strong>"Via URL"</strong></li>
                                            <li class="mb-2">Plak de gekopieerde link en klik op <strong>"Toevoegen"</strong></li>
                                        </ol>
                                    </v-expansion-panel-text>
                                </v-expansion-panel>

                                <v-expansion-panel>
                                    <v-expansion-panel-title class="heading">
                                        <v-icon color="#0C40AA" class="mr-3">mdi-apple</v-icon>
                                        Apple Calendar (iPhone/Mac)
                                    </v-expansion-panel-title>
                                    <v-expansion-panel-text>
                                        <div class="mb-3">
                                            <div class="text-subtitle-2 font-weight-bold mb-2">Mac:</div>
                                            <ol class="text-body-2 pl-4">
                                                <li class="mb-2">Open de <strong>Agenda</strong> app</li>
                                                <li class="mb-2">Ga naar <strong>Bestand â†’ Nieuw agenda-abonnement</strong></li>
                                                <li class="mb-2">Plak de link en klik op <strong>"Abonneren"</strong></li>
                                            </ol>
                                        </div>
                                        <div>
                                            <div class="text-subtitle-2 font-weight-bold mb-2">iPhone/iPad:</div>
                                            <ol class="text-body-2 pl-4">
                                                <li class="mb-2">Open <strong>Instellingen</strong></li>
                                                <li class="mb-2">Ga naar <strong>Agenda â†’ Accounts â†’ Account toevoegen â†’ Overige</strong></li>
                                                <li class="mb-2">Kies <strong>"Voeg abonnement op agenda toe"</strong></li>
                                                <li class="mb-2">Plak de link en tik op <strong>"Abonneren"</strong></li>
                                            </ol>
                                        </div>
                                    </v-expansion-panel-text>
                                </v-expansion-panel>

                                <v-expansion-panel>
                                    <v-expansion-panel-title class="heading">
                                        <v-icon color="#0C40AA" class="mr-3">mdi-microsoft-outlook</v-icon>
                                        Outlook
                                    </v-expansion-panel-title>
                                    <v-expansion-panel-text>
                                        <ol class="text-body-2 pl-4">
                                            <li class="mb-2">Open Outlook en ga naar de <strong>Agenda</strong> sectie</li>
                                            <li class="mb-2">Klik op <strong>"Agenda toevoegen"</strong></li>
                                            <li class="mb-2">Selecteer <strong>"Abonneren op internet"</strong></li>
                                            <li class="mb-2">Plak de link en klik op <strong>"Importeren"</strong></li>
                                        </ol>
                                    </v-expansion-panel-text>
                                </v-expansion-panel>
                            </v-expansion-panels>
                        </v-card-text>

                        <v-divider></v-divider>

                        <v-card-actions class="pa-4">
                            <v-spacer></v-spacer>
                            <v-btn
                                variant="text"
                                @click="subscribeDialog = false"
                                color="#0C40AA"
                            >
                                Sluiten
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Event Details Dialog -->
                <v-dialog v-model="eventDialog" max-width="500">
                    <v-card v-if="selectedEvent">
                        <v-card-title class="heading" style="color: #0C40AA;" v-text="selectedEvent.title">
                        </v-card-title>
                        <v-card-text>
                            <div v-if="selectedEvent.start" class="mb-2">
                                <v-icon size="small" class="mr-2">mdi-clock-outline</v-icon>
                                <strong>Start:</strong> <span v-text="formatDate(selectedEvent.start)"></span>
                            </div>
                            <div v-if="selectedEvent.end" class="mb-2">
                                <v-icon size="small" class="mr-2">mdi-clock-outline</v-icon>
                                <strong>Eind:</strong> <span v-text="formatDate(selectedEvent.end)"></span>
                            </div>
                            <div v-if="selectedEvent.location" class="mb-2">
                                <v-icon size="small" class="mr-2">mdi-map-marker</v-icon>
                                <strong>Locatie:</strong> <span v-text="selectedEvent.location"></span>
                            </div>
                            <div v-if="selectedEvent.description" class="mb-2">
                                <v-icon size="small" class="mr-2">mdi-text</v-icon>
                                <strong>Beschrijving:</strong><br>
                                <span v-text="selectedEvent.description"></span>
                            </div>
                            <div v-if="selectedEvent.url">
                                <v-btn
                                    :href="selectedEvent.url"
                                    target="_blank"
                                    color="#0C40AA"
                                    variant="outlined"
                                    size="small"
                                >
                                    <v-icon start>mdi-link</v-icon>
                                    Meer info
                                </v-btn>
                            </div>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn @click="eventDialog = false">Sluiten</v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Day Events Dialog -->
                <v-dialog v-model="dayEventsDialog" max-width="500">
                    <v-card>
                        <v-card-title class="heading" style="color: #0C40AA;">
                            Events op deze dag
                        </v-card-title>
                        <v-list>
                            <v-list-item
                                v-for="event in selectedDayEvents"
                                :key="event.title + event.start"
                                @click="eventDialog = true; dayEventsDialog = false; selectedEvent = event"
                            >
                                <v-list-item-title v-text="event.title"></v-list-item-title>
                                <v-list-item-subtitle v-text="formatDate(event.start)"></v-list-item-subtitle>
                            </v-list-item>
                        </v-list>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn @click="dayEventsDialog = false">Sluiten</v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Snackbar for notifications -->
                <v-snackbar v-model="snackbar" :color="snackbarColor" :timeout="3000">
                    <span v-text="snackbarText"></span>
                </v-snackbar>
            </v-container>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.0/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.0/dist/vuetify.min.js"></script>
    <script src="/static/embed.js"></script>
</body>
</html>
